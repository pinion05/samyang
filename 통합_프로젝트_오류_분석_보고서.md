# 삼양농업플랫폼 학습용 프로젝트 오류 분석 보고서

## 1. 개요
본 보고서는 Spring Boot 학습용 토이 프로젝트의 기술적 오류와 구조적 문제점을 분석한 것입니다. 보안 관련 사항은 학습 목적에 맞지 않으므로 제외하였습니다.

## 2. 프로젝트 현재 상태
- **기술적 오류**: 12개
- **구조적 문제**: 8개
- **누락된 기능**: 5개

## 3. 핵심 기술적 문제점

### 3.1 데이터베이스와 애플리케이션 매핑 불일치

#### ❌ User 테이블 구조 문제
**실제 DB 스키마**:
```sql
CREATE TABLE `User` (
  `UserID` int NOT NULL AUTO_INCREMENT,
  `Name` varchar(255),
  `Email` varchar(255),
  `Password` varchar(255),
  `PhoneNumber` varchar(20),
  `Address` varchar(255),
  `IsAdmin` tinyint(1),
  `CreatedAt` datetime
)
```

**문제점**:
1. **UserMapper.xml의 혼재된 쿼리**
   ```xml
   <!-- 구버전 쿼리 (정상 작동) -->
   SELECT PhoneNumber as phoneNumber, IsAdmin as isAdmin ...

   <!-- 신버전 쿼리 (오류 발생) -->
   SELECT LoginID as loginId, Phone as phone, Role as role ...
   <!-- LoginID, Phone, Role 컬럼이 실제로 존재하지 않음 -->
   ```

2. **UserDTO의 필드 혼란**
   ```java
   private String id;
   private Integer userId;
   private String username;
   // loginId 필드 없음 - 하지만 코드에서는 사용 시도
   ```

**영향**: 로그인 기능 작동 불가, 사용자 관리 오류

#### ❌ PaymentMethod 테이블 매핑 오류
**DB 컬럼**: `CVC`
**DTO/Mapper**: `cvv` 사용

**추가로 없는 컬럼 참조**:
- `paymentType`
- `cardHolderName` 
- `billingAddress`

### 3.2 외래키 참조 오류

#### ❌ Comment 테이블
- DB: `PostID` 컬럼 존재하나 Post 테이블 없음
- DTO: `relatedId`, `relatedType` 사용
- **문제**: 데이터베이스 설계와 애플리케이션 로직 불일치

#### ❌ Review 테이블
- DB: `OrderItemID` 참조하나 OrderItem 테이블 없음
- DTO: `productId` 사용하나 Product 테이블도 없음
- **문제**: 전체 리뷰 기능 작동 불가

### 3.3 MyBatis 설정 오류

#### ❌ resultType 패키지 경로 오류
```xml
<!-- 잘못된 경로 -->
<select id="getLogin" resultType="com.farm404.samyang.UserDTO.UserDTO">

<!-- 올바른 경로 -->
<select id="getLogin" resultType="com.farm404.samyang.dto.UserDTO">
```

#### ❌ 중복 메서드 정의
- `insertUser`와 `registerUser` 동일 기능
- `getUserById`와 `selectUserById` 동일 기능

### 3.4 Spring Boot 정적 리소스 설정 문제

#### ❌ CSS/JS 파일 접근 불가
**현재 구조**:
```
src/main/webapp/
├── css/style.css
├── js/main.js
└── views/*.jsp
```

**문제**: Spring Boot는 기본적으로 `src/main/resources/static`을 정적 리소스 경로로 인식

**해결 방법**:
1. 파일을 `src/main/resources/static`으로 이동
2. 또는 WebConfig에 설정 추가:
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/css/**").addResourceLocations("/css/");
        registry.addResourceHandler("/js/**").addResourceLocations("/js/");
    }
}
```

## 4. 아키텍처 및 설계 문제

### 4.1 레이어 책임 분리 미흡

#### ⚠️ DTO에 비즈니스 로직 포함
```java
// ReviewDTO.java
public String getStarRating() {
    StringBuilder stars = new StringBuilder();
    for (int i = 0; i < 5; i++) {
        if (i < rating) {
            stars.append("★");
        } else {
            stars.append("☆");
        }
    }
    return stars.toString();
}
```
**학습 포인트**: DTO는 데이터 전달용, 비즈니스 로직은 Service 레이어에

### 4.2 트랜잭션 관리 누락

#### ⚠️ Service 레이어에 @Transactional 없음
```java
@Service
// @Transactional 누락
public class UserService {
    public boolean registerUser(UserDTO user) {
        return userMapper.insertUser(user) > 0;
    }
}
```
**학습 포인트**: 데이터 변경 작업에는 트랜잭션 관리 필요

### 4.3 예외 처리 패턴 부재

#### ⚠️ 모든 예외를 Exception으로 처리
```java
try {
    // 비즈니스 로직
} catch (Exception e) {
    model.addAttribute("errorMessage", e.getMessage());
    return "error";
}
```
**학습 포인트**: 구체적인 예외 타입별 처리 필요

## 5. 데이터 타입 일관성 문제

### 5.1 날짜 타입 혼용
- FarmingDiaryDTO: `LocalDate`, `LocalDateTime` 혼용
- ReviewDTO: `LocalDateTime` 사용
- CommentDTO: `java.util.Date` 사용

**권장사항**: Java 8+ 에서는 `LocalDateTime` 통일 사용

### 5.2 ID 필드명 혼란
- UserDTO에 `id`와 `userId` 동시 존재
- 일부 코드는 `id` 사용, 일부는 `userId` 사용

## 6. 누락된 기능 구현

### 6.1 필수 테이블 부재
학습 프로젝트지만 전자상거래 플랫폼을 표방한다면 필요한 테이블:
- Product (상품)
- Order/OrderItem (주문)
- Cart (장바구니)
- Post (게시판)

### 6.2 CRUD 기능 미완성
- 일부 Controller 메서드만 구현
- View 페이지와 Controller 매핑 불일치

## 7. 개선 방안 (학습 관점)

### 7.1 즉시 수정 가능한 부분

#### 1. UserMapper.xml 정리
- 존재하지 않는 컬럼 참조 제거
- resultType 경로 수정
- 중복 메서드 제거

#### 2. UserDTO 통일
```java
public class UserDTO {
    private Integer userId;  // id 필드 제거하고 userId로 통일
    private String email;    // loginId 대신 email로 로그인
    private String name;
    private String password;
    private String phone;    // phoneNumber로 통일
    private Boolean isAdmin; // role 대신 isAdmin 사용
    private LocalDateTime createdAt;
    
    // Getters and Setters
}
```

#### 3. 정적 리소스 경로 수정
- CSS/JS 파일을 `src/main/resources/static`으로 이동

#### 4. 데이터 타입 통일
- 모든 날짜 필드를 `LocalDateTime`으로 통일

### 7.2 단계적 개선 계획

#### 1단계: 기본 기능 정상화 (1주)
1. DB 스키마와 Mapper XML 동기화
2. DTO 필드명 통일
3. 정적 리소스 경로 설정
4. 기존 CRUD 기능 정상 작동 확인

#### 2단계: Spring Boot 핵심 기능 학습 (2-3주)
1. **트랜잭션 관리 추가**
   ```java
   @Service
   @Transactional
   public class UserService {
       // 서비스 메서드들
   }
   ```

2. **검증 로직 구현**
   ```java
   @PostMapping("/register")
   public String register(@Valid @ModelAttribute UserDTO user, 
                         BindingResult result) {
       if (result.hasErrors()) {
           return "user/register";
       }
       // 저장 로직
   }
   ```

3. **예외 처리 개선**
   ```java
   @ExceptionHandler(DataAccessException.class)
   public String handleDatabaseError(DataAccessException e, Model model) {
       model.addAttribute("errorMessage", "데이터베이스 오류가 발생했습니다.");
       return "error";
   }
   ```

#### 3단계: 추가 기능 구현 (1개월)
1. 누락된 테이블 생성 및 기능 구현
2. RESTful API 패턴 적용
3. 페이징 처리 구현
4. 파일 업로드/다운로드 기능

## 8. 학습 체크리스트

### 완료된 학습 요소 ✅
- Spring Boot 프로젝트 구조
- MVC 패턴 기본 구현
- MyBatis 연동
- JSP 뷰 템플릿

### 추가 학습 필요 요소 📚
- [ ] 트랜잭션 관리 (@Transactional)
- [ ] 예외 처리 전략
- [ ] RESTful API 설계
- [ ] 유효성 검증 (Bean Validation)
- [ ] 페이징 및 정렬
- [ ] 파일 업로드/다운로드
- [ ] 세션 관리
- [ ] 인터셉터 활용

## 9. 성능 개선 제안

### 9.1 N+1 쿼리 문제 해결
현재 Review, Comment에서 userName을 개별 조회하는 문제가 있습니다.

**개선 방법**: JOIN 쿼리 사용
```xml
<select id="selectReviewsWithUser" resultType="ReviewDTO">
    SELECT r.*, u.Name as userName
    FROM Review r
    JOIN User u ON r.UserID = u.UserID
</select>
```

### 9.2 캐싱 전략 도입
반복적으로 조회되는 데이터에 대한 캐싱 적용을 고려할 수 있습니다.

## 10. 결론

이 프로젝트는 Spring Boot 학습용으로 기본적인 구조는 갖추었으나, 데이터베이스와 애플리케이션 간의 매핑 불일치가 가장 큰 문제입니다.

**우선 해결 과제**:
1. DB 스키마와 Mapper XML 동기화
2. DTO 필드명 통일
3. 정적 리소스 경로 설정

이러한 기본적인 문제를 해결한 후, RESTful API, 트랜잭션 관리, 예외 처리 등의 Spring Boot 핵심 기능을 단계적으로 학습하며 구현하는 것을 추천합니다.

학습 프로젝트의 목적에 맞게 보안보다는 Spring Boot의 핵심 기능 이해와 구현에 집중하시기 바랍니다.