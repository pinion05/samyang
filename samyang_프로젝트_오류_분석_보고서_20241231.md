# Samyang 프로젝트 오류 분석 보고서

**작성일**: 2024년 12월 31일  
**프로젝트**: Spring Boot CRUD 학습 프로젝트

## 요약

Spring Boot + MyBatis + MySQL 기반의 CRUD 학습 프로젝트에서 발견된 주요 작동 문제들을 분석하였습니다. 데이터베이스 스키마와 애플리케이션 코드 간의 매핑 불일치가 가장 심각한 문제로 확인되었으며, 이로 인해 실제 데이터베이스 작업 시 오류가 발생할 것으로 예상됩니다.

## 주요 발견 사항

### 1. 데이터베이스 스키마와 DTO 매핑 불일치 🚨

#### CommentDTO 문제
- **DB 스키마**: PostID (NOT NULL) 필드 존재
- **DTO 구현**: PostID 필드 누락, 대신 relatedId/relatedType 사용
- **영향**: Comment 테이블에 데이터 삽입 시 NOT NULL 제약조건 위반으로 오류 발생

#### ReviewDTO 문제
- **DB 필드명**: OrderItemID, Content
- **DTO 필드명**: productId, comment
- **영향**: MyBatis 매핑 실패로 리뷰 기능 전체 작동 불가

#### ReportDTO 문제
- **DB 필드명**: ReporterUserID, ReportType, TargetID, ReportedAt
- **DTO 필드명**: reporterId, reportedType/category, reportedId, createdAt
- **영향**: 신고 기능 데이터 처리 오류

### 2. MyBatis Mapper XML 테이블/컬럼명 불일치 🚨

#### 문제가 있는 Mapper 파일들
- **CommentMapper.xml**: 소문자 테이블명/컬럼명 사용 (comment, user, comment_id 등)
- **ReviewMapper.xml**: Comment 필드를 Content로 매핑해야 함
- **ReportMapper.xml**: 소문자 테이블명/컬럼명 사용

#### 정상적인 Mapper 파일
- **UserMapper.xml**: 올바른 대문자 사용 (User, UserID 등)

**영향**: MySQL의 lower_case_table_names 설정에 따라 쿼리 실패 가능

### 3. Spring Boot 3.x 호환성 문제 ⚠️

#### javax → jakarta 마이그레이션 필요
- **문제 파일**: UserController.java, CommentController.java 등
- **현재**: `import javax.servlet.http.HttpSession`
- **필요**: `import jakarta.servlet.http.HttpSession`
- **영향**: 컴파일 오류 발생

### 4. 기타 문제사항

#### PathVariable 한글 사용
- **위치**: UserController의 `/detail/{사용자ID}`
- **문제**: URL 인코딩 문제 발생 가능
- **권장**: 영문 사용 (`/detail/{userId}`)

#### 타입 불일치
- **PaymentMethodDTO**: ExpiryDate가 DB는 date 타입, DTO는 String
- **CommentDTO**: Date 사용 (LocalDateTime 권장)

## 심각도 평가

| 문제 | 심각도 | 영향 범위 |
|------|--------|-----------|
| DTO-DB 스키마 불일치 | 🔴 매우 심각 | 데이터 CRUD 전체 |
| MyBatis 매핑 오류 | 🔴 매우 심각 | 쿼리 실행 전체 |
| jakarta 마이그레이션 | 🟡 중간 | 컴파일/실행 |
| 타입 불일치 | 🟢 낮음 | 특정 기능 |

## 권장 해결 방안

### 1. 즉시 수정 필요 (Critical)

1. **CommentDTO 수정**
   - PostID 필드 추가
   - relatedId/relatedType 제거 또는 별도 처리

2. **ReviewDTO 수정**
   - productId → orderItemId 변경
   - comment → content 변경

3. **ReportDTO 수정**
   - 필드명을 DB 스키마와 일치시킴

4. **Mapper XML 파일 수정**
   - 모든 테이블명/컬럼명을 대문자로 통일

### 2. 중요 수정 사항

1. **Spring Boot 3.x 호환성**
   - 모든 javax.servlet → jakarta.servlet 변경

2. **타입 일관성**
   - 날짜 타입을 LocalDateTime으로 통일
   - String 타입의 날짜 필드를 적절한 타입으로 변경

### 3. 권장 개선 사항

1. **URL 패턴 개선**
   - PathVariable에서 한글 제거

2. **검증 로직 강화**
   - DTO 검증 어노테이션 추가
   - 서비스 레이어 검증 강화

## 결론

현재 상태로는 데이터베이스 작업이 정상적으로 수행될 수 없습니다. 특히 Comment, Review, Report 기능은 즉시 수정하지 않으면 런타임 오류가 발생할 것입니다. 

단순 CRUD 학습 프로젝트의 목적에 맞게, 복잡한 아키텍처보다는 **기본적인 매핑 일치**에 집중하여 수정하는 것을 권장합니다.

## 다음 단계

1. 위 권장사항에 따라 코드 수정
2. 각 CRUD 기능별 단위 테스트 수행
3. 통합 테스트로 전체 기능 검증
4. 수정 완료 후 재검증