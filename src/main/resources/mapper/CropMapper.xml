<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.farm404.samyang.mapper.CropMapper">

    <!-- 결과 매핑 -->
    <resultMap id="CropResultMap" type="com.farm404.samyang.dto.CropDTO">
        <id property="cropId" column="CropID"/>
        <result property="userId" column="UserID"/>
        <result property="cropName" column="CropName"/>
        <result property="variety" column="Variety"/>
        <result property="plantedDate" column="PlantedDate"/>
        <result property="expectedHarvestDate" column="ExpectedHarvestDate"/>
        <result property="status" column="Status"/>
        <result property="userName" column="UserName"/>
    </resultMap>

    <!-- 작물 정보 조회 -->
    <select id="selectCropById" parameterType="Integer" resultMap="CropResultMap">
        SELECT c.*, u.Name as UserName
        FROM Crop c
        LEFT JOIN User u ON c.UserID = u.ID
        WHERE c.CropID = #{cropId}
    </select>

    <!-- 사용자별 작물 목록 조회 -->
    <select id="selectCropsByUserId" parameterType="Integer" resultMap="CropResultMap">
        SELECT c.*, u.Name as UserName
        FROM Crop c
        LEFT JOIN User u ON c.UserID = u.ID
        WHERE c.UserID = #{userId}
        ORDER BY c.CropID DESC
    </select>

    <!-- 모든 작물 목록 조회 -->
    <select id="selectAllCrops" resultMap="CropResultMap">
        SELECT c.*, u.Name as UserName
        FROM Crop c
        LEFT JOIN User u ON c.UserID = u.ID
        ORDER BY c.CropID DESC
    </select>

    <!-- 작물 검색 -->
    <select id="searchCrops" parameterType="String" resultMap="CropResultMap">
        SELECT c.*, u.Name as UserName
        FROM Crop c
        LEFT JOIN User u ON c.UserID = u.ID
        WHERE c.CropName LIKE CONCAT('%', #{keyword}, '%')
           OR c.Variety LIKE CONCAT('%', #{keyword}, '%')
        ORDER BY c.CropID DESC
    </select>

    <!-- 작물 등록 -->
    <insert id="insertCrop" parameterType="com.farm404.samyang.dto.CropDTO" useGeneratedKeys="true" keyProperty="cropId">
        INSERT INTO Crop (UserID, CropName, Variety, PlantedDate, ExpectedHarvestDate, Status)
        VALUES (#{userId}, #{cropName}, #{variety}, #{plantedDate}, #{expectedHarvestDate}, #{status})
    </insert>

    <!-- 작물 정보 수정 -->
    <update id="updateCrop" parameterType="com.farm404.samyang.dto.CropDTO">
        UPDATE Crop
        SET CropName = #{cropName},
            Variety = #{variety},
            PlantedDate = #{plantedDate},
            ExpectedHarvestDate = #{expectedHarvestDate},
            Status = #{status}
        WHERE CropID = #{cropId}
    </update>

    <!-- 작물 삭제 -->
    <delete id="deleteCrop" parameterType="Integer">
        DELETE FROM Crop
        WHERE CropID = #{cropId}
    </delete>

    <!-- 작물 상태별 조회 -->
    <select id="selectCropsByStatus" parameterType="String" resultMap="CropResultMap">
        SELECT c.*, u.Name as UserName
        FROM Crop c
        LEFT JOIN User u ON c.UserID = u.ID
        WHERE c.Status = #{status}
        ORDER BY c.CropID DESC
    </select>

</mapper>